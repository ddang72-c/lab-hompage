---
import SectionLayout from "../../../layouts/SectionLayout.astro";
import type { MarkdownInstance } from "astro";

const nav = [
  { label: "News", href: "/board/news/" },
  { label: "Gallery", href: "/board/gallery/" },
];

type FM = Record<string, any>;
const modules = import.meta.glob<MarkdownInstance<FM>>("/src/content/board/gallery/*.md");

export async function getStaticPaths() {
  return Object.keys(modules).map((path) => {
    const slug = path.split("/").pop()?.replace(/\.md$/, "") ?? path;
    return { params: { slug }, props: { path } };
  });
}

const { path } = Astro.props as { path: string };
const entry = await modules[path]();
const { Content, frontmatter } = entry;

const title = frontmatter?.title ?? "Gallery";
const photos = (frontmatter?.photos ?? frontmatter?.images ?? []) as string[];
---

<SectionLayout title={title} sectionLabel="BOARD" navItems={nav} heroSrc="/images/sub-hero.jpg">
  <h1>{title}</h1>

  {Array.isArray(photos) && photos.length > 0 && (
    <div class="gallery-detail-grid">
      {photos.map((src) => (
        <a class="photo" href={src} target="_blank" rel="noreferrer">
          <img src={src} alt={title} loading="lazy" />
        </a>
      ))}
    </div>
  )}

  <div class="gallery-body" style="line-height:1.8;">
    <Content />
  </div>

  <div style="margin-top:22px;">
    <a class="btn" href="/board/gallery/">Back to list</a>
  </div>
</SectionLayout>
