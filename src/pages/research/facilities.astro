---
import SectionLayout from "../../layouts/SectionLayout.astro";
import type { MarkdownInstance } from "astro";

type FM = { title?: string; image?: string; link?: string };

const modules = import.meta.glob<MarkdownInstance<FM>>(
  "/src/content/research/facilities/*.md"
);

const items = await Promise.all(
  Object.entries(modules).map(async ([path, loader]) => {
    const entry = await loader();
    const title = (entry.frontmatter?.title ?? "Untitled").toString();
    const image = (entry.frontmatter?.image ?? "").toString();
    const link = (entry.frontmatter?.link ?? "").toString().trim(); // ✅ 옵션
    const Content = entry.Content;
    return { path, title, image, link, Content };
  })
);

items.sort((a, b) => a.title.localeCompare(b.title));
---

<SectionLayout title="Facilities">
  <style is:global>
    .fac-wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 18px;
      margin-top: 24px;
    }

    .fac-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 24px;
    }

    .fac-card {
      display: flex;
      gap: 18px;
      padding: 16px;
      border: 1px solid #eee;
      border-radius: 0;
      background: #fff;
    }

    .fac-img {
      width: 160px;
      height: 160px;
      object-fit: cover;
      border-radius: 0;
      flex: 0 0 auto;
    }

    .fac-title {
      margin: 0 0 6px 0;
      font-size: 1.2rem;
      font-weight: 700;
      line-height: 1.25;
    }

    .fac-body {
      line-height: 1.7;
      margin-top: 6px;
    }

    @media (max-width: 900px) {
      .fac-grid {
        grid-template-columns: 1fr;
      }
      .fac-card {
        flex-direction: column;
      }
      .fac-img {
        width: 100%;
        height: 220px;
      }
    }
  </style>

  <div class="fac-wrap">
    <div class="fac-grid">
      {items.map((it) => (
        <article class="fac-card">
          {it.image && <img class="fac-img" src={it.image} alt="" loading="lazy" />}

          <div style="flex: 1; min-width: 0;">
            <h2 class="fac-title">{it.title}</h2>

            <div class="fac-body">
              <it.Content />
            </div>

            {it.link && (
              <div style="margin-top: 10px;">
                <a class="pub-btn" href={it.link} target="_blank" rel="noreferrer">
                  link
                </a>
              </div>
            )}
          </div>
        </article>
      ))}
    </div>

    {items.length === 0 && (
      <p class="muted" style="margin-top: 18px;">
        No facilities yet.
      </p>
    )}
  </div>
</SectionLayout>
