---
import SectionLayout from "../../layouts/SectionLayout.astro";
import type { MarkdownInstance } from "astro";

type FM = { title?: string; order?: number };

const modules = import.meta.glob<MarkdownInstance<FM>>("/src/content/research/posts/*.md");

const posts = await Promise.all(
  Object.entries(modules).map(async ([path, loader]) => {
    const entry = await loader();

    const rawTitle = entry.frontmatter?.title;
    const title = typeof rawTitle === "string" ? rawTitle.trim() : ""; 

    const order = Number(entry.frontmatter?.order ?? 0);
    const Content = entry.Content;

    return { path, title, order, Content };
  })
);

posts.sort((a, b) => (b.order - a.order) || b.path.localeCompare(a.path));
---

<SectionLayout title="Research area">
  <style is:global>
    .research-wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 18px;
    }

    .research-post {
      display: flow-root;
      padding: 28px 0;
    }

    .research-post + .research-post {
      border-top: 1px solid #e5e5e5;
    }

    .research-title {
      margin: 0 0 14px 0;
      font-size: 1.55rem;
      font-weight: 700;
      line-height: 1.25;
    }

    .research-body::after {
      content: "";
      display: block;
      clear: both;
    }

    .rc-figure {
      text-align: center;
    }
    .rc-figure figcaption {
      text-align: center;
    }
  </style>

  <div class="research-wrap">
    {posts.map((p) => (
      <article class="research-post">
        {p.title && <h2 class="research-title">{p.title}</h2>}

        <div class="research-body">
          <p.Content />
        </div>
      </article>
    ))}
  </div>
</SectionLayout>
