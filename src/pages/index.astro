---
import BaseLayout from "../layouts/BaseLayout.astro";
import "../styles/home.css";


const homeEntries = await Astro.glob("../content/home/home.md");
const home = homeEntries[0];

const slides = (home?.frontmatter?.slides ?? []).map((s) => ({
  src: s.image,
  alt: s.alt ?? "",
}));

const about = home?.frontmatter?.about ?? {};
---

<BaseLayout title="LETS">
  <section class="home-slider" aria-label="Home slider" data-slider>
    <div class="home-slider-viewport" data-viewport>
      <div class="home-slider-track" data-track>
        {slides.length > 0 ? (
          slides.map((s, idx) => (
            <figure class="home-slide">
              <img src={s.src} alt={s.alt} loading={idx === 0 ? "eager" : "lazy"} />
            </figure>
          ))
        ) : (
          <figure class="home-slide">
            <div style="padding: 40px; text-align:center; color: rgba(0,0,0,.6);">
              No slides yet. Add slides in <b>/admin</b> â†’ Home.
            </div>
          </figure>
        )}
      </div>

      {slides.length > 1 && (
        <>
          <button class="slider-btn slider-btn--prev" type="button" aria-label="Previous slide" data-prev>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M15.5 19 8.5 12l7-7"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>

          <button class="slider-btn slider-btn--next" type="button" aria-label="Next slide" data-next>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M8.5 5 15.5 12l-7 7"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </>
      )}
    </div>

    {slides.length > 1 && (
      <div class="home-slider-dots" aria-hidden="true" data-dots>
        {slides.map((_, i) => (
          <span class={`dot ${i === 0 ? "is-active" : ""}`}></span>
        ))}
      </div>
    )}

    <div class="home-slider-rule" aria-hidden="true"></div>
  </section>

  <section class="home-about" aria-label="About section">
    <div class="home-about-inner">
      <div class="home-about-media">
        <img
          class="home-about-image"
          src={about.image ?? "/images/home/wordcloud.png"}
          alt="About image"
          loading="lazy"
        />
      </div>

      <div class="home-about-content">
        <h2 class="home-about-title">{about.title ?? "About..."}</h2>
        <p class="home-about-text">{about.text ?? ""}</p>
        <a class="home-about-btn" href={about.buttonLink ?? "/research/research-area/"}>
          {about.buttonText ?? "More about Research Area"}
        </a>
      </div>
    </div>
  </section>

  <div class="home-section-rule" aria-hidden="true"></div>

</BaseLayout>

<script is:inline>
  (() => {
    const root = document.querySelector("[data-slider]");
    if (!root) return;

    const track = root.querySelector("[data-track]");
    const slides = Array.from(root.querySelectorAll(".home-slide"));
    const prevBtn = root.querySelector("[data-prev]");
    const nextBtn = root.querySelector("[data-next]");

    const dotsWrap = root.querySelector("[data-dots]");
    const dots = dotsWrap ? Array.from(dotsWrap.querySelectorAll(".dot")) : [];

    if (!track || slides.length <= 1 || !prevBtn || !nextBtn) return;

    let idx = 0;

    const setIndex = (next) => {
      idx = (next + slides.length) % slides.length;
      track.style.transform = `translateX(-${idx * 100}%)`;

      if (dots.length) {
        dots.forEach((d, i) => d.classList.toggle("is-active", i === idx));
      }
    };

    prevBtn.addEventListener("click", () => setIndex(idx - 1));
    nextBtn.addEventListener("click", () => setIndex(idx + 1));

    root.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") setIndex(idx - 1);
      if (e.key === "ArrowRight") setIndex(idx + 1);
    });

    root.tabIndex = 0;

    setIndex(0);
  })();
</script>
