---
const navGroups = [
  {
    label: "PEOPLE",
    href: "/people/professor",
    dropdown: [
      { label: "Professor", href: "/people/professor" },
      { label: "Students", href: "/people/students" },
      { label: "Alumni", href: "/people/alumni" },
    ],
  },
  {
    label: "RESEARCH",
    href: "/research/research-area",
    dropdown: [
      { label: "Research Area", href: "/research/research-area" },
      { label: "Facilities", href: "/research/facilities" },
    ],
  },
  {
    label: "PUBLICATION",
    href: "/publication/journal",
    dropdown: [
      { label: "Journal", href: "/publication/journal" },
      { label: "Conference", href: "/publication/conference" },
    ],
  },
  {
    label: "BOARD",
    href: "/board/news",
    dropdown: [
      { label: "News", href: "/board/news" },
      { label: "Gallery", href: "/board/gallery" },
    ],
  },
];
---

<header class="site-header">
  <div class="header-main">
    <div class="header-main-inner header-main-inner--wide">
      <a class="brand" href="/" aria-label="Home">
        <span class="brand-logos" aria-hidden="true">
          <img class="brand-logo brand-logo--logo2" src="/images/logo1.png" alt="" />
          <img class="brand-logo brand-logo--logo1" src="/images/logo2.png" alt="" />
        </span>
      </a>

      <!-- Desktop nav with dropdown -->
      <nav class="gnb" aria-label="Main navigation">
        <ul class="gnb-list">
          {navGroups.map((g) => (
            <li class="gnb-item">
              <a class="gnb-link" href={g.href}>{g.label}</a>
              <ul class="dropdown" aria-label={`${g.label} submenu`}>
                {g.dropdown.map((it) => (
                  <li class="dropdown-item">
                    <a href={it.href}>{it.label}</a>
                  </li>
                ))}
              </ul>
            </li>
          ))}
        </ul>
      </nav>

      <!-- Mobile toggle -->
      <button
        class="nav-toggle"
        type="button"
        aria-label="Open menu"
        aria-controls="mobileMenu"
        aria-expanded="false"
      >
        ☰
      </button>
    </div>
  </div>

  <!-- Mobile overlay -->
  <div id="mobileMenu" class="mobile-overlay" aria-hidden="true">
    <div class="mobile-overlay-inner">
      <div class="mobile-topbar">
        <button class="mobile-close" type="button" aria-label="Close menu">×</button>
      </div>

      <div class="mobile-card">
        {navGroups.map((g) => (
          <details class="mobile-group">
            <summary class="mobile-summary">
              <span class="mobile-summary-label">{g.label}</span>
              <span class="mobile-summary-caret">▾</span>
            </summary>
            <ul class="mobile-sub">
              {g.dropdown.map((it) => (
                <li><a href={it.href}>{it.label}</a></li>
              ))}
            </ul>
          </details>
        ))}
      </div>
    </div>
  </div>
  
<script is:inline>
  // 중복 바인딩 방지(페이지 이동/리렌더 상황 대비)
  if (!window.__mobileMenuInited) {
    window.__mobileMenuInited = true;

    const initMobileMenu = () => {
      const overlay = document.getElementById('mobileMenu');
      const openBtn = document.querySelector('.nav-toggle');
      const closeBtn = document.querySelector('.mobile-close');

      if (!overlay || !openBtn || !closeBtn) return;

      const groups = Array.from(overlay.querySelectorAll('details.mobile-group'));

      const closeAllGroups = () => {
        groups.forEach((d) => {
          d.open = false;
        });
      };

      const openMenu = () => {
        overlay.classList.add('is-open');
        overlay.setAttribute('aria-hidden', 'false');
        openBtn.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      };

      const closeMenu = () => {
        overlay.classList.remove('is-open');
        overlay.setAttribute('aria-hidden', 'true');
        openBtn.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';

        closeAllGroups();
        overlay.scrollTo({ top: 0 });
      };

      // ✅ 한 번에 하나만 열리는 아코디언
      groups.forEach((d) => {
        d.addEventListener('toggle', () => {
          if (!d.open) return;
          groups.forEach((other) => {
            if (other !== d) other.open = false;
          });
        });
      });

      openBtn.addEventListener('click', openMenu);
      closeBtn.addEventListener('click', closeMenu);

      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) closeMenu();
      });

      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMenu();
      });
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileMenu);
    } else {
      initMobileMenu();
    }
  }
</script>
</header>